<div class="vacancies-list-container">
  <!-- Page Header -->
  <div class="page-header">
    <h1 class="page-title">Vacantes</h1>
  </div>

  <!-- Filters -->
  <div class="filters-card">
    <div class="filters-row">
      <!-- Search -->
      <div class="filter-group filter-search-group">
        <label class="filter-label" for="vacancySearch">Buscar título</label>
        <div class="search-input-wrapper">
          <mat-form-field appearance="outline" class="filter-field filter-search">
            <input
              matInput
              id="vacancySearch"
              placeholder="Título del puesto..."
              [ngModel]="searchFilter()"
              (ngModelChange)="onSearchTitleChange($event)"
              aria-label="Buscar título"
            />
            <mat-icon matPrefix>search</mat-icon>
          </mat-form-field>
          @if (isSearchingTitle()) {
            <div class="search-indicator">
              <mat-spinner diameter="16"></mat-spinner>
              <span>Buscando...</span>
            </div>
          }
        </div>
      </div>

      <!-- Status -->
      <div class="filter-group">
        <label class="filter-label" for="statusFilter">Estado</label>
        <mat-form-field appearance="outline" class="filter-field">
          <mat-select
            id="statusFilter"
            [ngModel]="statusFilter()"
            (ngModelChange)="statusFilter.set($event); applyFilters()"
          >
            @for (option of statusOptions; track option.value) {
              <mat-option [value]="option.value">{{ option.label }}</mat-option>
            }
          </mat-select>
        </mat-form-field>
      </div>

      <!-- Comercial (Assigned To) -->
      <div class="filter-group">
        <label class="filter-label" for="assignedSearch">Comercial</label>
        <mat-form-field appearance="outline" class="filter-field filter-assigned">
          <input
            matInput
            id="assignedSearch"
            placeholder="Buscar comercial..."
            [ngModel]="assignedFilter()"
            (ngModelChange)="onAssignedSearchChange($event)"
            [disabled]="myAssignmentsActive()"
            aria-label="Comercial"
          />
          <mat-icon matPrefix>person</mat-icon>
        </mat-form-field>
      </div>

      <!-- My Assignments -->
      <div class="filter-group">
        <span class="filter-label" aria-hidden="true">Mis Asignaciones</span>
        <app-custom-button
          [label]="myAssignmentsActive() ? 'Ver todos' : 'Mis Asignaciones'"
          [variant]="myAssignmentsActive() ? 'primary' : 'secondary'"
          [type]="'button'"
          (buttonClick)="toggleMyAssignments()"
          class="assigned-toggle-btn"
        />
      </div>

      <!-- Source -->
      <div class="filter-group">
        <label class="filter-label" for="sourceFilter">Fuente</label>
        <mat-form-field appearance="outline" class="filter-field">
          <mat-select
            id="sourceFilter"
            [ngModel]="sourceFilter()"
            (ngModelChange)="sourceFilter.set($event); applyFilters()"
          >
            @for (option of sourceOptions; track option.value) {
              <mat-option [value]="option.value">{{ option.label }}</mat-option>
            }
          </mat-select>
        </mat-form-field>
      </div>

      <!-- US State -->
      <div class="filter-group">
        <label class="filter-label" for="stateFilter">Estado USA</label>
        <mat-form-field appearance="outline" class="filter-field">
          <mat-select
            id="stateFilter"
            [ngModel]="stateFilter()"
            (ngModelChange)="stateFilter.set($event); applyFilters()"
          >
            @for (state of usStates; track state.value) {
              <mat-option [value]="state.value">{{ state.label }}</mat-option>
            }
          </mat-select>
        </mat-form-field>
      </div>

      <!-- Company -->
      <div class="filter-group">
        <label class="filter-label" for="companySearch">Empresa</label>
        <div class="search-input-wrapper">
          <mat-form-field appearance="outline" class="filter-field">
            <input
              matInput
              id="companySearch"
              placeholder="Buscar empresa..."
              [ngModel]="companyFilter()"
              (ngModelChange)="onCompanySearchChange($event)"
              aria-label="Buscar empresa"
            />
          </mat-form-field>
          @if (isSearchingCompany()) {
            <div class="search-indicator">
              <mat-spinner diameter="16"></mat-spinner>
              <span>Buscando...</span>
            </div>
          }
        </div>
      </div>

      <!-- Date From -->
      <div class="filter-group">
        <label class="filter-label" for="dateFrom">Desde</label>
        <mat-form-field appearance="outline" class="filter-field">
          <input
            matInput
            id="dateFrom"
            type="date"
            [ngModel]="dateFrom()"
            (ngModelChange)="dateFrom.set($event)"
            (change)="applyFilters()"
            aria-label="Desde"
          />
        </mat-form-field>
      </div>

      <!-- Date To -->
      <div class="filter-group">
        <label class="filter-label" for="dateTo">Hasta</label>
        <mat-form-field appearance="outline" class="filter-field">
          <input
            matInput
            id="dateTo"
            type="date"
            [ngModel]="dateTo()"
            (ngModelChange)="dateTo.set($event)"
            (change)="applyFilters()"
            aria-label="Hasta"
          />
        </mat-form-field>
      </div>

      <!-- Clear Filters -->
      <div class="filter-group filter-actions">
        <span class="filter-label" aria-hidden="true">&nbsp;</span>
        <app-custom-button
          label="Limpiar"
          variant="secondary"
          [type]="'button'"
          (buttonClick)="clearFilters()"
          class="clear-btn"
        />
      </div>
    </div>
  </div>

  <!-- Table -->
  <div class="table-card">
    <!-- Table Header -->
    <div class="table-header">
      <span class="table-count">{{ paginationInfo() }}</span>
      <app-custom-button
        label="Nueva Vacante"
        variant="primary"
        icon="add"
        (buttonClick)="openCreateDialog()"
      />
    </div>

    <!-- Loading Spinner -->
    @if (isLoading()) {
      <div class="loading-container">
        <mat-spinner diameter="40"></mat-spinner>
      </div>
    } @else {
      <!-- Data Table -->
      <table mat-table [dataSource]="vacancies()" class="vacancies-table">
        <!-- Job Title Column -->
        <ng-container matColumnDef="jobTitle">
          <th mat-header-cell *matHeaderCellDef>Título</th>
          <td mat-cell *matCellDef="let vacancy">
            <span class="job-title">{{ vacancy.jobTitle }}</span>
          </td>
        </ng-container>

        <!-- Company Column -->
        <ng-container matColumnDef="companyName">
          <th mat-header-cell *matHeaderCellDef>Empresa</th>
          <td mat-cell *matCellDef="let vacancy">
            <a class="company-link" [routerLink]="['/companies', vacancy.companyId]">
              {{ vacancy.companyName }}
            </a>
          </td>
        </ng-container>

        <!-- Location Column -->
        <ng-container matColumnDef="location">
          <th mat-header-cell *matHeaderCellDef>Ubicación</th>
          <td mat-cell *matCellDef="let vacancy">{{ vacancy.location }}</td>
        </ng-container>

        <!-- Status Column -->
        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef>Estado</th>
          <td mat-cell *matCellDef="let vacancy">
            <app-pipeline-badge [stage]="vacancy.pipelineStage"></app-pipeline-badge>
          </td>
        </ng-container>

        <!-- Assigned To Column -->
        <ng-container matColumnDef="assignedTo">
          <th mat-header-cell *matHeaderCellDef>Asignado</th>
          <td mat-cell *matCellDef="let vacancy">
            <span class="assigned-name">{{ vacancy.assignedTo || '-' }}</span>
          </td>
        </ng-container>

        <!-- Source Column -->
        <ng-container matColumnDef="source">
          <th mat-header-cell *matHeaderCellDef>Fuente</th>
          <td mat-cell *matCellDef="let vacancy">{{ getSourceLabel(vacancy.source) }}</td>
        </ng-container>

        <!-- Published Date Column -->
        <ng-container matColumnDef="publishedDate">
          <th mat-header-cell *matHeaderCellDef>Publicado</th>
          <td mat-cell *matCellDef="let vacancy">{{ formatDate(vacancy.publishedDate) }}</td>
        </ng-container>

        <!-- Actions Column -->
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Acciones</th>
          <td mat-cell *matCellDef="let vacancy">
            <button
              mat-button
              color="primary"
              (click)="goToDetail(vacancy); $event.stopPropagation()"
            >
              <mat-icon aria-hidden="true">visibility</mat-icon>
              Ver
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr
          mat-row
          *matRowDef="let vacancy; columns: displayedColumns"
          (click)="goToDetail(vacancy)"
          class="vacancy-row"
        ></tr>
      </table>

      <!-- Paginator -->
      <app-custom-paginator
        [currentPage]="currentPage()"
        [pageSize]="pageSize()"
        [totalItems]="totalItems()"
        [pageSizeOptions]="pageSizeOptions"
        (pageChange)="onPageChange($event)"
      />
    }
  </div>
</div>

<!-- Create Vacancy Modal -->
<app-create-vacancy-modal
  [isOpen]="showCreateModal()"
  (submitCreate)="onCreateVacancy($event)"
  (closeModal)="closeCreateModal()"
/>
