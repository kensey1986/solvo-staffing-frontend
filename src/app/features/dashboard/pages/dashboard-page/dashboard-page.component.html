<div class="dashboard-page">
  <header class="dashboard-page__header">
    <div class="dashboard-page__header-left">
      <h1 class="dashboard-page__title">Dashboard</h1>
      @if (lastUpdated() && !isLoading() && !hasError()) {
        <span class="dashboard-page__last-updated">Actualizado: {{ lastUpdated() }}</span>
      }
    </div>
    <div class="dashboard-page__header-actions">
      <button
        mat-icon-button
        (click)="loadData()"
        [disabled]="isLoading()"
        title="Actualizar datos"
      >
        <mat-icon [class.spinner]="isLoading()">refresh</mat-icon>
      </button>
    </div>
  </header>

  <div class="dashboard-page__content">
    @if (isLoading()) {
      <div class="dashboard-page__loading">
        <div class="skeleton-grid">
          @for (item of [1, 2, 3, 4, 5]; track item) {
            <div class="skeleton-card"></div>
          }
        </div>
        <p>Cargando datos del dashboard...</p>
      </div>
    } @else if (hasError()) {
      <div class="dashboard-page__error">
        <mat-icon color="error">error_outline</mat-icon>
        <p>Error al cargar los datos del dashboard.</p>
        <app-custom-button label="Reintentar" variant="primary" (buttonClick)="loadData()" />
      </div>
    } @else {
      <!-- Vacancies Pipeline -->
      <section class="dashboard-page__section">
        <h2 class="dashboard-page__section-title">Pipeline de Vacantes</h2>
        <div class="dashboard-page__kpi-grid">
          @for (kpi of dashboardData()?.vacancyKpis; track kpi.label) {
            <app-kpi-card
              [label]="kpi.label"
              [value]="kpi.value"
              [icon]="kpi.icon"
              [iconColor]="$any(kpi.color)"
            />
          }
        </div>
      </section>

      <!-- Companies Pipeline -->
      <section class="dashboard-page__section">
        <h2 class="dashboard-page__section-title">Pipeline de Empresas</h2>
        <div class="dashboard-page__kpi-grid">
          @for (kpi of dashboardData()?.companyKpis; track kpi.label) {
            <app-kpi-card
              [label]="kpi.label"
              [value]="kpi.value"
              [icon]="kpi.icon"
              [iconColor]="$any(kpi.color)"
            />
          }
        </div>
      </section>
    }
  </div>
</div>
